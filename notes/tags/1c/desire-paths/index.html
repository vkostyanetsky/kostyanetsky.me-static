

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Desire Paths</title>

    <meta name="description" content="On the harm of template approaches in development." />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Vlad's Site" href="https://kostyanetsky.me/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.me/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.me/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.me/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.me/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="Desire Paths"/>
    <meta property="og:description" content="On the harm of template approaches in development."/>
    <meta property="og:image" content="https://kostyanetsky.me/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.me/notes/desire-paths" />    

    <!-- Tachyons -->

    <link rel="stylesheet" href="https://kostyanetsky.me/assets/tachyons.min.css">

    <!-- Blog -->

    <script>

        let ctrlUpUrl       = '';
        let ctrlDownUrl     = '';
        let ctrlLeftUrl     = 'https://kostyanetsky.me/notes/tags/1c/harmless-harm';
        let ctrlRightUrl    = '';

    </script>
    
    <link rel="stylesheet" href="https://kostyanetsky.me/assets/blog.css">
    <script src="https://kostyanetsky.me/assets/blog.js"></script>
                
</head>

<body class="w-100 bg-white">

<div id="app">        
<main>

<header class="db dt-l w-100-l border-box pa3 ph5-l">

    <nav class="flex items-center lh-copy pa3 ph0-l">
    
        <a href="https://kostyanetsky.me"><img class="br-100" src="https://kostyanetsky.me/assets/images/me.jpg" title="Hi!" /></a>

        <div class="pl4 flex-auto">
        
            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me">Vlad's Site</a>
            

            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me/projects/">Projects</a>
                        

            
                <a class="dib f4 mr3 link dim bb orange" href="https://kostyanetsky.me/notes/">Notes</a>
            

        </div>
        
    </nav>
    
    <nav class="dtc-l v-mid tc tr-l">

        
            <a href="https://kostyanetsky.ru/notes/desire-paths" class="link f5 f5-ns dim blue bb">RU</a>
        

        

            <div class="mt3">

            
                <a title="Found a typo? Edit me!" href="https://github.com/vkostyanetsky/kostyanetsky.me/edit/main/notes/desire-paths/index.md" class="f4 f4-ns dim blue no-underline">✎</a>
            

            </div>
            
        

    </nav>

</header>

<section class="pa3 pa5-ns bt b--black-10 black-70 bg-white">
    

    <article>    
                    
        <h1 class="f-subheadline lh-solid">Desire Paths</h1>
            
        
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Alright, Jean Fresco's riddle. You've got a table — say, ~50k rows. How do you end up reading half a billion?</p>
<p>Easy-peasy: Nested Loops + Clustered Index Seek:</p>
<p><img alt="Half a billion" src="https://kostyanetsky.me/notes/desire-paths/500_million.png"/></p>
<p>Clustered Index Seek is a bit of a marketing name here, of course. In reality, on every execution the operator walks the entire table (the whole clustered index) and checks every row against the predicates. And it does that 10 730 times for 51 391 rows. Result: 551 425 430 rows read, 13 343 returned.</p>
<p><img alt="Ouch" src="https://kostyanetsky.me/notes/desire-paths/ouch.gif"/></p>
<p>So yeah — a perfect textbook example of a horrible query plan in a vacuum. Put it in a museum. Nested Loops, if you've forgotten, works roughly like this:</p>
<pre>
For Each Table1Row In Table1 Do
    For Each Table2Row In Table2 Do
        ...
</pre>
<p>That's fine for small tables, but the DB can also pick it for bigger ones — for example, if it runs out of time to build a proper plan.</p>
<p>That's exactly what happened here. Zooming out to the platform level: we've got a dynamic list that queries a documents table, and the devs bolted on like a dozen virtual tables from accumulation registers.</p>
<p>Some of those registers were huge on their own, and the virtual tables poured gasoline on the fire (each one turns into 2+ nested queries). The DB honestly tried to come up with an efficient strategy, but at some point it basically decided: "a garbage plan is still better than no plan at all".</p>
<p>And the user? They tried to search a document by number — and the client app just straight-up froze.</p>
<p>So, about virtual tables in dynamic lists. There's a nice English phrase: "desire path" — the trail people naturally carve because it's the easiest way. Slapping a virtual table onto the main one really is often the simplest, fastest, most familiar way to solve the task. But it's <strong>not efficient</strong>.</p>
<p>There's an alternative, for example the OnGetDataAtServer() handler. It takes longer to implement, but it lets you properly tune the virtual table and avoid the scenario above. Scrolling the list will produce more queries, sure — but they'll be smaller, faster, and way more efficient than one single giant monster query.</p>
        <p class="f6 mt4">
            29 November 2025
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/optimization/">optimization</a>
                </span>
            
        </p>
    </div>


        
        

            <p class="mt5 mb3 f6">

                
                    <a class="mr4 link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/harmless-harm">Harmless Harm</a> &larr;
                
                Ctrl
                                

            </p> 
            
        

    </article>


</section>

</main>

<footer class="ph3 ph4-ns pv4 bt b--black-10 black">
    
    <p class="f6 lh-solid">Email: <a href="mailto:vlad@kostyanetsky.ru" class="link dim bb black">vlad@kostyanetsky.me</a></p>
    <p class="f6 lh-solid">Telegram: <a href="tg://resolve?domain=vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    <p class="f6 lh-solid">GitHub: <a href="https://github.com/vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    
    <a class="rss" href="https://kostyanetsky.me/rss.xml">RSS</a> 

</footer>

</div>
</body>
</html>