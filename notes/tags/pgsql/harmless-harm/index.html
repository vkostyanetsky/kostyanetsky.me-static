

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Harmless Harm</title>

    <meta name="description" content="About the features of parameterized queries in MS SQL and PostgreSQL." />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Vlad's Site" href="https://kostyanetsky.me/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.me/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.me/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.me/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.me/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="Harmless Harm"/>
    <meta property="og:description" content="About the features of parameterized queries in MS SQL and PostgreSQL."/>
    <meta property="og:image" content="https://kostyanetsky.me/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.me/notes/harmless-harm" />    

    <!-- Tachyons -->

    <link rel="stylesheet" href="https://kostyanetsky.me/assets/tachyons.min.css">

    <!-- Blog -->

    <script>

        let ctrlUpUrl       = '';
        let ctrlDownUrl     = '';
        let ctrlLeftUrl     = 'https://kostyanetsky.me/notes/tags/pgsql/rapture';
        let ctrlRightUrl    = '';

    </script>
    
    <link rel="stylesheet" href="https://kostyanetsky.me/assets/blog.css">
    <script src="https://kostyanetsky.me/assets/blog.js"></script>
                
</head>

<body class="w-100 bg-white">

<div id="app">        
<main>

<header class="db dt-l w-100-l border-box pa3 ph5-l">

    <nav class="flex items-center lh-copy pa3 ph0-l">
    
        <a href="https://kostyanetsky.me"><img class="br-100" src="https://kostyanetsky.me/assets/images/me.jpg" title="Hi!" /></a>

        <div class="pl4 flex-auto">
        
            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me">Vlad's Site</a>
            

            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me/projects/">Projects</a>
                        

            
                <a class="dib f4 mr3 link dim bb orange" href="https://kostyanetsky.me/notes/">Notes</a>
            

        </div>
        
    </nav>
    
    <nav class="dtc-l v-mid tc tr-l">

        
            <a href="https://kostyanetsky.ru/notes/harmless-harm" class="link f5 f5-ns dim blue bb">RU</a>
        

        

            <div class="mt3">

            
                <a title="Found a typo? Edit me!" href="https://github.com/vkostyanetsky/kostyanetsky.me/edit/main/notes/harmless-harm/index.md" class="f4 f4-ns dim blue no-underline">✎</a>
            

            </div>
            
        

    </nav>

</header>

<section class="pa3 pa5-ns bt b--black-10 black-70 bg-white">
    

    <article>    
                    
        <h1 class="f-subheadline lh-solid">Harmless Harm</h1>
            
        
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>The other day my colleague and I were debugging an issue, nothing fancy, just another "why is this query behaving weird?" moment.</p>
<p>Simplified, the idea was: we read a table from the database and dump the result into a temp table. If a certain condition is met, we still want the temp table to be created, but it must be empty (regardless of whether the source table has rows or not).</p>
<p>The query looked roughly like this:</p>
<pre>
SELECT
    Table.Field1 AS Field1
FROM
    Table AS Table
WHERE 
    &amp;Parameter
</pre>
<p>If we needed to copy rows from the source table into the temp table, we passed TRUE into the parameter; if we wanted the temp table to be empty, we passed FALSE.</p>
<p>Looks simple at first glance, but this trick is a silent performance foot-gun if the table being read is large.</p>
<p>The reason is how DB engines work with parameterized queries. Both MS SQL and PostgreSQL build the execution plan based on the query text, and in this example the parameter value does <strong>not</strong> affect the decision of whether the table should be read or not.</p>
<p>As a result, when this query runs, both engines will pedantically scan the whole table (or its index), even if the parameter is FALSE. In that case each row is just discarded, so the logic is technically correct, but we're wasting resources on a pointless scan and polluting the buffer cache, slowing down the system overall and diligently contributing to global warming :)</p>
<p>The fix is simple: inline TRUE/FALSE in the query body as a constant instead of using a parameter. Or use TOP so the query text is even simpler:</p>
<pre>
SELECT TOP 0
    Table.Field1 AS Field1
FROM
    Table AS Table
</pre>
<p>At the SQL level this turns into something like "SELECT TOP 0 ... FROM Table" for MS SQL and "SELECT ... FROM Table LIMIT 0" for PostgreSQL. The final plan will still contain a read operator, but the executor won't actually request any rows, so there's no real data scan (yay).</p>
<p>P.S. If you don't care about having proper column types in the temp table, you can even do this:</p>
<pre>
SELECT TOP 0
    UNDEFINED AS Field1
</pre>
<p>The performance gain, however, is so tiny that it's probably not worth over-optimizing for this. There are better hills to die on.</p>
        <p class="f6 mt4">
            16 November 2025
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/pgsql/">PostgreSQL</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/mssql/">MS SQL</a>
                </span>
            
        </p>
    </div>


        
        

            <p class="mt5 mb3 f6">

                
                    <a class="mr4 link blue bb dim" href="https://kostyanetsky.me/notes/tags/pgsql/rapture">Rapture</a> &larr;
                
                Ctrl
                                

            </p> 
            
        

    </article>


</section>

</main>

<footer class="ph3 ph4-ns pv4 bt b--black-10 black">
    
    <p class="f6 lh-solid">Email: <a href="mailto:vlad@kostyanetsky.ru" class="link dim bb black">vlad@kostyanetsky.me</a></p>
    <p class="f6 lh-solid">Telegram: <a href="tg://resolve?domain=vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    <p class="f6 lh-solid">GitHub: <a href="https://github.com/vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    
    <a class="rss" href="https://kostyanetsky.me/rss.xml">RSS</a> 

</footer>

</div>
</body>
</html>