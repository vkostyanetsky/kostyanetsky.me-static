

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>1С</title>

    <meta name="description" content="" />
    
    <!-- RSS -->

    <link rel="alternate" type="application/rss+xml" title="Vlad's Site" href="https://kostyanetsky.me/rss.xml" />

    <!-- Icons -->

    <link rel="icon" href="https://kostyanetsky.me/favicon.ico">
    <link rel="icon" href="https://kostyanetsky.me/assets/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://kostyanetsky.me/assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="https://kostyanetsky.me/manifest.webmanifest">    

    <!-- Open Graph -->

    <meta property="og:title" content="1С"/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content="https://kostyanetsky.me/assets/images/og.jpg">
    <meta property="og:type" content="article"/>
    <meta property="og:url" content= "https://kostyanetsky.me/notes/tags/1c" />    

    <!-- Tachyons -->

    <link rel="stylesheet" href="https://kostyanetsky.me/assets/tachyons.min.css">

    <!-- Blog -->

    <script>

        let ctrlUpUrl       = '';
        let ctrlDownUrl     = 'https://kostyanetsky.me/notes/tags/1c/page-2';
        let ctrlLeftUrl     = '';
        let ctrlRightUrl    = '';

    </script>
    
    <link rel="stylesheet" href="https://kostyanetsky.me/assets/blog.css">
    <script src="https://kostyanetsky.me/assets/blog.js"></script>
                
</head>

<body class="w-100 bg-white">

<div id="app">        
<main>

<header class="db dt-l w-100-l border-box pa3 ph5-l">

    <nav class="flex items-center lh-copy pa3 ph0-l">
    
        <a href="https://kostyanetsky.me"><img class="br-100" src="https://kostyanetsky.me/assets/images/me.jpg" title="Hi!" /></a>

        <div class="pl4 flex-auto">
        
            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me">Vlad's Site</a>
            

            
                <a class="dib f4 mr3 link dim bb blue" href="https://kostyanetsky.me/projects/">Projects</a>
                        

            
                <a class="dib f4 mr3 link dim bb orange" href="https://kostyanetsky.me/notes/">Notes</a>
            

        </div>
        
    </nav>
    
    <nav class="dtc-l v-mid tc tr-l">

        
            <a href="https://kostyanetsky.ru/notes/tags/1c" class="link f5 f5-ns dim blue bb">RU</a>
        

        

            <div class="mt3">

            
                    <span class="f4 f4-ns">✎</span>
            

            </div>
            
        

    </nav>

</header>

<section class="pa3 pa5-ns bt b--black-10 black-70 bg-white">
    

    <article>

        <h1 class="f-subheadline lh-solid">1С</h1>

        

        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/no/">No</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p><img alt="No" src="https://kostyanetsky.me/notes/no/no.jpg"/></p>
<p>This is the message the current platform throws up when you try to connect to an offline server cluster. I do appreciate minimalism in interfaces, of course, but this is definitely over the top.</p>
<p>What's more, the platform is installed with only a single language pack (English) and even launched with a hard override to "Ven VLen", yet somehow the native birches still manage to sprout up. Maybe the C++ library that fires off the message (DataExchangeTcpClientImpl.cpp) is looking at the OS language (Russian) in my case — hard to say.</p>
<p>Anyway, I can't shake the Bugs Bunny vibes every time I see that dialog box.</p>
<p><img alt="No" src="https://kostyanetsky.me/notes/no/bugs-bunny.png"/></p>
        <p class="f6 mt4">
            11 June 2025
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/bit-of-surgery/">A Little Bit Of Surgery</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>A few years ago, I stumbled upon a story about a programmer who had to debug software controlling a surgical robot — right in the middle of an operation. That blew my mind, to be frank.</p>
<p>Today, my colleague and I were fixing a 1C cluster with databases running on 1cFresh. After migrating it to a neighboring server, the thing suddenly started acting up. Long story short: trying to print a document would send the client app into its death throes.  </p>
<p>While we were knee-deep in troubleshooting, I had this thought: sure, it doesn’t look as terrifying as debugging software that someone’s life literally depends on. But if you think about all the clients sitting on edge because their business is grinding to a halt... Well, who knows where the stress levels are higher?  </p>
<p><strong>P.S. Nerdy details for the curious.</strong> During the migration, the permissions for the server cache folder didn’t transfer properly. This led to a funny (well, not so funny) effect: the logs would happily land there, but session data wouldn’t.  </p>
<p>So, when someone opened a print form, the configuration tried saving it to the storage, and rphost, in turn, attempted to shove it into the session cache. Here’s where things went sideways: the worker' process (probably) got slapped on the wrist by the OS. Due to (apparently) some funky file system event handling in the platform, the exception wasn’t caught, so the poor thing had no better idea than to kill the session. Naturally, this caused the client process to crash.  </p>
<p>We fixed the permissions, rebooted the cluster, and voilà! The problem was gone.  </p>
<p><img alt="End of Report" src="https://kostyanetsky.me/notes/bit-of-surgery/report.jpeg"/></p>
<p>All other hypotheses — cluster manager acting up, lack of hardware resources, configuration bugs, client-side issues, broken security profiles, network problems between the client and server — got tossed out during the diagnostics process.</p>
        <p class="f6 mt4">
            17 December 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/rapture/">Rapture</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>I remember how amazed I was when I worked with window functions in PostgreSQL for the first time. You can adjust the calculation window for each row individually! And even segment it in advance. And all this is done natively, within a regular query, no extra add-ons needed. The standard aggregation with grouping and subqueries that I was used to in 1C suddenly turned into a pumpkin, just like Cinderella's carriage at midnight.</p>
<p>Recently, I’ve been learning Blender, and I suddenly felt the same excitement for the same reason. The fact that you can freely move objects around the 3D Viewport with the Move command was clear from the start, fine. However, when it hit me that each object is a set of polygons, and that each polygon can also be moved freely, leading to a natural reshaping of the object's geometry — that’s when it really got me.</p>
<p>Technology is amazing. Learning is awesome. Moments like these make me want to keep doing it over and over again :)</p>
        <p class="f6 mt4">
            31 August 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/pgsql/">PostgreSQL</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/3d/">3D</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/nowhere-to-run/">Nowhere To Run</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Yesterday, I decided to take a break from work and go for a good run. I headed to the local park and did a few laps. Sitting there catching my breath, I grabbed my phone to switch the track, and there it was — a congratulations from my fitness tracker.</p>
<p><img alt="Oh hi" src="https://kostyanetsky.me/notes/nowhere-to-run/hi.jpg"/></p>
<p>So much for taking a break. The platform is watching you, %username%!</p>
<p>P.S. But hey, now I’ve got a custom badge with the platform's logo. Gotta wear it with pride!</p>
        <p class="f6 mt4">
            31 August 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/sport/">sport</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/yaga/">Yaga</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>I accidentally remembered that six months ago, one of my colleagues threw a link to <a href="https://yaga.rt.ru" target="_blank">Yaga</a> into the work chat. It is a future (I guess) competitor of JIRA in Russia. Judging by the URL, the guys from Rostelecom are developing it. Here my curiosity was awakened — how is it there, did it take off?</p>
<p>Alas, but looks like nope. At least, the landing page has the “leave a request and wait for a response beep” vibe. Only a simplified version is available for smaller teams that I can't touch as well: being not in Russia and clicking on the “Start using” button leads me to a ban. Welp, next time, maybe.</p>
<p>The naming is clickbait, of course. But I’m not sure if it’s really a good choice. For example, “1C” may provoke forced jokes (One s! Odin's ass! Haha), but if you google this, you are more likely to find information about the platform or at least the vendor. Not a bunch of articles, fan fiction, fan art, or video games, as in the case of Yaga.</p>
<p>Moreover, some wrong associations come to mind. What does Baba Yaga reminds you of? A hut on chicken legs? It looks like an initially <a href="https://kostyanetsky.me/notes/evolution" target="_blank">poorly designed</a> application that was somehow remade right on production. A mortar? A crutch? Damn, if you look at it from the point of view of programmers — these are not red flags, but real scarlet banners fluttering in the wind :)</p>
<p>One more thing: I'm probably spoiled, but when I hear the word “Yaga”, the first thing that pops into my head is not a powerful witch from Slavic folklore, but <a href="https://en.wikipedia.org/wiki/Jaguar_(drink)" target="_blank">disgusting booze</a> from the 2000s.</p>
<blockquote>
<p>Now Baba with Yaga are no longer redneck, but a patriotic programmer!</p>
<p>― colleague</p>
</blockquote>
        <p class="f6 mt4">
            29 Jule 2024
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/meanwhile/">meanwhile</a>
                </span>
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/data-history-duplication/">Non-Unique Metadata</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Once again, I came across a nasty bug when the platform broke the data history metadata table.</p>
<p>Outwardly, it looks like this: you update the database configuration, and when you try to restructure, the error “The data history metadata table contains duplicate records. Delete the duplicate records” pops up. The platform does not offer any clear way to find such records.</p>
<p><img alt="The data history metadata table contains duplicate records. Delete the duplicate records" src="https://kostyanetsky.me/notes/data-history-duplication/error.png"/></p>
<p>The problem can be solved at the database level. The table referenced by the error is _DataHistoryMetadata. It contains metadata versions of each object for which data history is being maintained. This allows the platform to understand what attributes the object had at any point in time if the data history is maintained for the object.</p>
<p>How does it work? Well, when the list of an object’s attributes changes (for example, an attribute was added to the catalog), the platform writes its metadata: specifically, it adds a new entry to _DataHistoryMetadata and stores in it the current list of object attributes, as well as the version number of this list (for example, when history is enabled for an object, the first version of metadata is saved, when adding some attribute, the second version is saved, and so on).</p>
<p>The platform also puts a mark in the created record that this particular version of the object is the most actual, and then removes this mark from the version that was marked as actual before.</p>
<p>So, the problem is that the platform sometimes forgets to take the last step, and two versions appear in the table at once, marked as current. The Designer understands this but cannot do anything.</p>
<p>The solution follows from the algorithm above: you need to find conflicting versions and revoke the mark of actuality from the one that is older. It is better to use queries: data history is often enabled for a bunch of objects, and the list of their attributes is constantly changing — in general, there will be so many versions in the table that the devil will break his leg.</p>
<p>If you also encountered this problem and are therefore reading this text, you can use the <a href="https://gist.github.com/vkostyanetsky/6496c67e2b2fd3d064c4cafd16da0b79" target="_blank">queries</a> that I wrote:</p>
<ol>
<li>get-issues.sql checks that there is an issue: it looks for metadata versions that are also marked as actual.</li>
<li>fix-issues.sql removes the actuality mark from those versions that are actually outdated.</li>
</ol>
<p>Both queries are written for Microsoft SQL Server. If you use PostgreSQL, then <a href="https://gist.github.com/vkostyanetsky/75665ce04247e900743604eb386d1889" target="_blank">here they are</a> for this DBMS.</p>
<p>The queries will require a slight adaptation to a specific database: they use the _fld626 field, which is the data separator. In your _DataHistoryMetadata table, this field may be called differently, so you need to update its name to the current one. It will be difficult to make a mistake — the table has only one field with the _fld prefix.</p>
<p>P.S. Please bear in mind that the license agreement prohibits access to the database, bypassing the platform’s tools, so you can only go for such experiments if there are no other options left.</p>
        <p class="f6 mt4">
            8 June 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/pgsql/">PostgreSQL</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/mssql/">MS SQL</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/uuid-main-issue/">The Main Issue of UUID</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>I came across a <a href="https://www.cybertec-postgresql.com/en/unexpected-downsides-of-uuid-keys-in-postgresql/" target="_blank">good text</a> about the main problem that UUID brings with itself. It is also relevant for 1C: all platform reference objects (catalog items, documents, and so on) have their own UUID. They are stored in a database, actively used in searches, and, of course, extensively indexed (with all the ensuing consequences).</p>
<p>1C tries to suppress the issue by creating consistent UUIDs. It may not be perfect, but overall, this thing works, and the indexes turn out to be more or less compact. In general, the community has been talking about this for a long time: for example, the old <a href="https://forum.mista.ru/topic.php?id=801986" target="_blank">thread on Mista</a> (though the conversation here quickly turned into a chicken coop, and out of six dozen comments, at most one and a half are on point).</p>
<p>P.S. The remark about the probability of creating two identical UUIDs in one database made me laugh:</p>
<blockquote>
<p>As an aside, for those worried about collisions: you should take up the lottery, since winning the jackpot twice in a row is a much more likely outcome than your system ever generating two identical random 128 bit numbers.</p>
</blockquote>
        <p class="f6 mt4">
            2 June 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/pgsql/">PostgreSQL</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/payment-terms/">One Query More, One Query Less</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>One query more, one query less — it doesn’t matter, people often say. Like, the main thing is that the query must be cheap: it doesn’t read too much, uses index, and so on.</p>
<p>This point of view makes sense, but mindlessly machine-gunning queries is a dangerous idea. Even if everything looks good at the moment, the system may change slightly in the future. And then a seemingly harmless patch will burn your production server to the ground right on Friday.</p>
<p>Let me tell you about one example from recent practice. There is an ERP that contains a table with payment stages for customer orders. One of these stages is prepayment; until it is received, you cannot create an order for the supplier.</p>
<p>Technically, the purchase order simply stores the customer's order ID; if the field is filled (that is, if the purchase order is created by the customer's order), ERP needs to read the payment stages of the customer's order and understand whether the purchase can be made.</p>
<p>It sounds elementary, but monitoring shows that the operation is slow as hell and eats up memory as if it were the last time. </p>
<p>Welp, let's go find out. We saw something like this:</p>
<p><img alt="825701 records" src="https://kostyanetsky.me/notes/payment-terms/payment-terms.png"/></p>
<p>What do we have here? Instead of taking two or three stages of payment for an order, ERP reads almost a million! How this could be possible?</p>
<p>It turned out that the problem was with those purchase orders that were not related to customer orders at all. The developer considered that the logic for them could not be changed: the customer’s order ID is empty and the query will not find payment stages for this ID. This means that the same result will be obtained as if there were no query at all. And an extra query — well... One query more, one query less... Not a big deal.</p>
<p>The deal turned out to be big. The table of payment stages contained data not only for customer orders, but also for other types of documents. Their customer order ID field was empty. As a result, ERP, when trying to find payment stages using an empty customer order ID, unexpectedly found them.</p>
<p>The query read about a gigabyte of data and wrote it to a temporary table. A gigabyte was read, then a gigabyte was written... History hit the disk, the DBMS buffer cache, and other components of the system (even the network, which had to drive this gigabyte back and forth without any benefit).</p>
<p>Do you know what I think? If the result of a query is known, there is probably no need to do it after all.</p>
        <p class="f6 mt4">
            5 May 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/optimization/">optimization</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/not-only-everything/">Not Only Everything</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>This commentary in the documentation for the WriteJSON() method of XDTOSerializer is enviably deep, I would say:</p>
<p><img alt="Not only everyhing" src="https://kostyanetsky.me/notes/not-only-everything/write-json.jpg"/></p>
<p>Well, yes. The method dumps data into JSON, not XML. So it’s hard to argue that not all value types can be packed into XML using it (to be precise, none). Such a pity that there is an obvious copy-paste from the help for WriteXML() further in the text! I almost decided that it was an Easter egg from the developers :)</p>
        <p class="f6 mt4">
            25 February 2024
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/last-meth/">Last Meth</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>I'm digging into the code of an external component for 1C platform, published by its developers as an example. The good thing is: well, it can be compiled and if you tweak it a little — it does the job.</p>
<p>As for other things, there are a lot of bruh moments. For example, the project can't be opened in modern Visual Studio (you need to specify CMake manually). The code is quite sloppy; there is no documentation, comments, or formatting. Long story short: I believe, it can be difficult for a developer without solid experience in C++ to get the hang of this.</p>
<p>Was a bit amused by the naming in the code below:</p>
<pre><code>long CAddInNative::FindMethod(const WCHAR_T* wsMethodName)
{ 
    long plMethodNum = -1;
    wchar_t* name = 0;

    ::convFromShortWchar(&amp;name, wsMethodName);

    plMethodNum = findName(g_MethodNames, name, eMethLast);

    if (plMethodNum == -1)
        plMethodNum = findName(g_MethodNamesRu, name, eMethLast);

    delete[] name;

    return plMethodNum;
}
</code></pre>
<p>I see here the inexplicable love for abbreviations. What made the author name the variable “eMethLast”, not “eMethodLast”? They already created "wsMethodName" and "plMethodNum", after all.</p>
<p>Perhaps this is an Easter egg with a reference to Breaking Bad. Then I like it for sure :)</p>
        <p class="f6 mt4">
            17 December 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/how-to-be-a-hero/">Everyday Heroism</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Some time ago, I was setting up <a href="https://swagger.io" target="_blank">Swagger</a> for the internal API. While I was fiddling around, it became clear that some functionality did not need to be included in the documentation. I was looking for a way to do this without crutches and came across a funny <a href="https://github.com/tiangolo/full-stack-fastapi-couchbase/issues/10" target="_blank">question</a> on GitHub.</p>
<p>What's funny, you ask? Well, I involuntarily remembered <a href="https://forum.mista.ru" target="_blank">Mista</a>. Among 1C developers, this is synonymous with the word “toxicity”: if you ask anything there, you get a bucket of slop by the collar instead of an answer. Here, of course, everything is not so neglected, but holy crap! These persistent guys who referring to the 14-page manual made me laugh a lot.</p>
<p>One thing is good: by the end of the thread, there appeared a brave rebel who just answered the question. They, like, named the required parameter for a FastAPI method's decorator, which is not supposed to be shown in the documentation. No links — could you imagine?</p>
<p>Not all heroes wear capes, I would say.</p>
        <p class="f6 mt4">
            24 September 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/swagger/">Swagger</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/do-you-speak-english/">Do you speak English?</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>The repository login form of the current platform (8.3.22.1923, to be precise) launched with the English interface:</p>
<p><img alt="Login Form" src="https://kostyanetsky.me/notes/do-you-speak-english/login-form.png"/></p>
<p>You had one job, literally.</p>
<p>I heard some rumors that development of the Designer was stopped largely due to the monstrous amount of technical debt that slows down any new features. But here are interface glitches right on one of the first application windows! Curious how it got through the build tests.</p>
<p>Maybe they don't exist at all.</p>
        <p class="f6 mt4">
            14 May 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/pause/">Pause()</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <blockquote>
<p>An important detail: the CallPause method is not available in a client-server call; when a client calls a server method in which CallPause is called, the exception "Cannot call the CallPause method in a client-server call" will be thrown.</p>
<p><a href="https://wonderland.v8.1c.ru/blog/metod-vyzvatpauzu/" target="_blank">CallPause Method</a> (RU)</p>
</blockquote>
<p>What a strange restriction, to be frank. On the one hand, an experienced developer will not make an intentional pause in a client-server call anyway; on the other hand, whoever wants to make it makes it anyway (by checking time in a cycle, for example). Does security by obscurity worth the efforts?</p>
<p>At best, some junior will catch this exception, think “welp, it looks like I'm doing something wrong” and move in the right direction. However, putting the restriction on the platform for the sake of this case is like firing a cannon at sparrows. You know what? Let's implement a number limit as well — like, no more than 1000 pauses per session, otherwise users will suddenly think that the program is too slow :-)</p>
        <p class="f6 mt4">
            30 April 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/in-a-pedantic-way/">In a Pedantic Way</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>The daily award for the most philosophical code goes to the author of this elegant way to check that two boolean variables are not equal to each other:</p>
<pre><code>If DataStructure.Property("AmountVATIn")
    And ((DataStructure.AmountVATIn And NOT SearchPriceIncludesVAT)
    OR (NOT DataStructure.AmountVATIn And SearchPriceIncludesVAT)) Then    
    Price = RecalculateAmountOnVATFlagsChange(Price, DataStructure.AmountVATIn, TabSectionLine.VATRate);
EndIf;
</code></pre>
<p>I'm thinking of adding something like “And Not (DataStructure.AmountVATIn = SearchPriceIncludesVAT)” here to spice it up with a subtle note of insanity.</p>
        <p class="f6 mt4">
            21 Marth 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/code-smell/">code smell</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/outgoing-requests-limiter/">Slow down, I'm recording</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Usually the idea of developing is simple: the faster it works, the better. For example, the more requests an application manages to execute per unit of time, the faster the task for which these requests are needed will be solved.</p>
<p>However, it also happens the other way around: you need to reduce the number of operations that a program is able to perform. Let's imagine we exchange data with an external service and it bans if we hit it with requests too often. For example: the cloud version of <a href="https://bitrix24.net" target="_blank">Bitrix24</a> requires sending requests to it no more than two per second.</p>
<p>Here is an <a href="https://github.com/vkostyanetsky/OutgoingRequestsLimiter" target="_blank">implementation</a> of such a slowdown, which I wrote last week. There is no queue support; the main solved problem is to execute as many requests as possible without going beyond the limit (taking into account the fact that requests can be made from different sessions).</p>
<p>The problem is solved through a constant that stores the date for the current second and the number of requests that have already been sent. Clients who run into a limitation are waiting. This approach is not suitable for high-loaded systems, but otherwise it can come in handy.</p>
        <p class="f6 mt4">
            5 Marth 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/bitrix/">Bitrix</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/done/">done</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/rest-service-4-sm/">REST service for Service Manager</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>This week, I developed a REST service to set up our service manager (this is a configuration for managing a 1cFresh instance). Deploying the development environment is a regular task for us, and every time the manager's database had to be tuned by hand: tweaking the storefront, changing application addresses, overwriting scheduled tasks, and so on.</p>
<p>The implementation was simple. Come up with a JSON structure, write a parser, find a code in the configuration, make it work by external call, and make sure you don't break anything. Routine work, in general, but I love to do such things from time to time: I mean, to look around and try to figure out which of the daily tasks is annoying enough.</p>
<p>This one is a good example. To be frank, setting up the Service Manager wasn't a problem (launching the app and fiddling with the settings), but it was a thing to pay attention &amp; spend time to. What do we have now:</p>
<ol>
<li>There is a JSON file with all the settings;</li>
<li>There is a REST service for its processing;</li>
<li>There is a script that will put the first into the second;</li>
<li>There is a pipeline that will do it all by itself.</li>
</ol>
<p>In short, a boot was rubbing a leg, and now it isn't. Yahoo!</p>
        <p class="f6 mt4">
            25 February 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/haul-trucks/">Haul Trucks</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p><img alt="Cars" src="https://kostyanetsky.me/notes/haul-trucks/cars.jpg"/></p>
<p>The colleague grumbled that if you think like that, then the configurator will be Zhiguli, and the EDT will be Kama1 (this is an electric car that has been developed somewhere in the depths of KAMAZ for many years and still can’t gather strength and, finally, show the wonder to the world).</p>
<p>Well, I try to look at things with optimism. I think the platform and its IDE are such haul trucks. No one in their right mind rides them on household chores, but these beasts are irreplaceable on a cut!</p>
        <p class="f6 mt4">
            20 February 2023
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/shaken-not-stirred/">Shaken, Not Stirred</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>Let's speak a bit about organization of the code. If you need to describe a set of objects with common properties, think about whether this description should be divided into separate methods, each of which intended to describe one specific object?</p>
<p>Let's look at this example — a method that describes tabular parts of documents suitable for some task:</p>
<pre><code>SupportedTypes["Document.SupplierPricesEntering"]   = "Prices";
SupportedTypes["Document.OpeningBalancesEntering"]  = "CustomerAccounts,VendorAccounts";
SupportedTypes["Document.Requisition"]              = "InventoryAndServices";
</code></pre>
<p>Everything seems fine, right? Descriptions are there; tabular parts are listed; splitting them by comma doesn't look expensive at all.</p>
<p>However, there are many documents in the method. Eventually, some colleague (or you) will need to refer to another tabular part of the document, which is already mentioned in the method. Something will distract they, they will forget to look for an existing line and something like this will turn out:</p>
<pre><code>SupportedTypes["Document.SupplierPricesEntering"]   = "Prices";
SupportedTypes["Document.OpeningBalancesEntering"]  = "CustomerAccounts,VendorAccounts";
SupportedTypes["Document.Requisition"]              = "InventoryAndServices";

&lt;...&gt;

SupportedTypes["Document.OpeningBalancesEntering"]  = "PayrollDeductions";
</code></pre>
<p>As a result, a part of description will be erased, and it's good if the related functionality is covered by tests.</p>
<p>Conclusion? Well, you can write a helper method that will take the document type and the name of <strong>one</strong> table part as input. The helper will add items to the SupportedTypes map and ensure that the data already added is not lost.</p>
<p>However, if you need a better solution, then consider doing as I wrote at the beginning of this note: split the method into auxiliary methods. One method contains description for one document only (for all its tabular sections). Something like:</p>
<pre><code>Procedure AddOpeningBalancesEnteringDocument(SupportedTypes)

    TabularSections = New Array;

    TabularSections.Add("CustomerAccounts");
    TabularSections.Add("VendorAccounts");
    TabularSections.Add("PayrollDeductions");

    SupportedTypes["Document.Requisition"] = StrConcat(TabularSections, ",");

EndProcedure
</code></pre>
<p>What do we get here? Firstly, nobody will accidentally erase the description of the document. Secondly, SonarQube will be pleased: it is highly likely to begin swearing at repeating literals with the names of tabular parts, if the helper is implemented instead of code splitting.</p>
        <p class="f6 mt4">
            7 August 2022
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/do-not-confuse/">Do Not Confuse</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p><img alt="Code" src="https://kostyanetsky.me/notes/do-not-confuse/do-not-confuse.png"/></p>
<p>If the type of operation is the sale of goods or real estate, then open the common form AdvancesPickFormWithVAT with the parameters defined in the PickParameters structure. The callback is EditPrepaymentOffsetEnd method, defined in the same module; pass it the AdditionalParameters structure. The form needs to be opened so that it locks the whole interface.</p>
<p>However, if the type of operation is a return to the supplier, then open the general form AdvancesPickFormWithVAT with the parameters defined in the PickParameters structure. The callback is the EditPrepaymentOffsetEnd method, defined in the same module; pass it the AdditionalParameters structure. The form needs to be opened so that it locks the whole interface.</p>
<p>I hope you won't confuse.</p>
        <p class="f6 mt4">
            16 Marth 2022
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/code-smell/">code smell</a>
                </span>
            
        </p>
    </div>



        

            <h2 class="f2 lh-title"><a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/1c/reuse-carefully/">Reuse Carefully</a></h2>

            
    
    <div class="f4 lh-copy black mb5 measure-wide">
        <p>I'll tell you about a funny and a little embarrassing case that I took apart in January. The essence in a nutshell: a huge auto-test based on Vanessa, which is intended to check the VAT calculation, falls somewhere near the end.</p>
<p>I start investigating. First, I look at the screenshots in Allure: OK, the reason is obvious – in one of the documents, the conditional appearance for the field with the VAT amount doesn't work. The test expected it to be unavailable if the VAT rate is zero, but it turned out to be available somehow.</p>
<p>It's a mess, it needs to be fixed! I look at the condition in the code: well, it locks the field if the VAT rate is in the list of “zero” rates (list of VAT rates whose rate is equal to zero). Everything appears to be simple and logical. What the hell could possibly go wrong here?</p>
<p><a href="https://twitter.com/EffinBirds/status/1489980393675702281" target="_blank"><img alt="Tweet" src="https://kostyanetsky.me/notes/reuse-carefully/snap-tweet-EffinBirds-1489980393675702281.png"/></a></p>
<p>Well, I try to reproduce the bug manually. And there, all of a sudden, everything is nice: the conditional appearance works as it should. Floating bug, or what? I run the auto-test again, at the right moment I jump in with the debugger and find some outright garbage: in the list of “zero” rates, besides themselves, there are a bunch of empty links!</p>
<p>Frankly speaking, I was scratching the back of my head. The document receives this list from the common module with <a href="https://gist.github.com/vkostyanetsky/5ec036ee148606aad9caefbc9305bfb0" target="_blank">this code</a>. An empty ref from here, even theoretically, cannot be obtained. Moreover, the module has the “Reuse Return Values” option ​​enabled, and the function is actually executes once somewhere at the beginning of the test, before all complex data manipulations. So, the test cannot affect it in any way, in theory.</p>
<p>Is it a dead end? Well, experienced colleagues have probably already guessed everything, but I had to dance around the bug  and even check the <a href="https://its.1c.ru/db/v8std/content/724/hdoc" target="_blank">standard</a>, until got the following: <strong>return values ​​cache in 1C can be changed</strong>. I mean, not by calling RefreshReusableValues​​(), but by changing reusable values directly.</p>
<p>How? Well, if you get some values ​​from a cached common module, and they are not of a primitive type (string, number, etc.), you will not get the value itself, but a pointer to it somewhere in memory. You write this pointer to a variable and try to change it – you change the cache.</p>
<p>It's that simple, yes. This is what happened in my case: the form of another document called the method that generates the list of “zero” rates. Having received a list of values, it added an empty ref to it and used it in its logic. Thus, each time this form opens, the list cache contains more and more empty refs, which eventually broke the document at the other end of the configuration.</p>
<p><a href="https://twitter.com/EffinBirds/status/1488165946342662144" target="_blank"><img alt="Tweet" src="https://kostyanetsky.me/notes/reuse-carefully/snap-tweet-EffinBirds-1488165946342662144.png"/></a></p>
<p>In a good way, the platform should throw exceptions when developer trying to change the cache, but until this happens, you have to take care yourself. For example, when developing cached modules, return immutable data types from them (FixedStructure instead of Structure, FixedArray instead of Array, and so on). True, this is not a 100% protection: firstly, fixed types are not applicable everywhere, and secondly, even in the latest versions of the SSL, this is far from being done everywhere. Do you know many configurations not based on SSL?</p>
<p>Sonar also know nothing about the problem, as well as less popular software. No silver bullet, in short – check your code, look at the code of your colleagues and try not to forget about another elegant way to bang ourselves in the foot.</p>
        <p class="f6 mt4">
            8 February 2022
            
                <span class="pl2">
                    <a class="link orange bb dim" href="https://kostyanetsky.me/notes/tags/1c/">1С</a>
                </span>
            
                <span class="pl2">
                    <a class="link blue bb dim" href="https://kostyanetsky.me/notes/tags/work/">work</a>
                </span>
            
        </p>
    </div>



        

        

            <p class="mt5 mb3 f6">
                <a class="link blue bb dim mr1 mt5 mb3" href="https://kostyanetsky.me/notes/tags/1c/page-2">Earlier</a> Ctrl + &darr;
            </p>

        

    </article>


</section>

</main>

<footer class="ph3 ph4-ns pv4 bt b--black-10 black">
    
    <p class="f6 lh-solid">Email: <a href="mailto:vlad@kostyanetsky.ru" class="link dim bb black">vlad@kostyanetsky.me</a></p>
    <p class="f6 lh-solid">Telegram: <a href="tg://resolve?domain=vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    <p class="f6 lh-solid">GitHub: <a href="https://github.com/vkostyanetsky" class="link dim bb black">vkostyanetsky</a></p>
    
    <a class="rss" href="https://kostyanetsky.me/rss.xml">RSS</a> 

</footer>

</div>
</body>
</html>